<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üé† SG Playground Finder</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f8f9fa;
        }
        
        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 1rem;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        header h1 { font-size: 1.5rem; margin-bottom: 0.25rem; }
        header p { opacity: 0.9; font-size: 0.85rem; }
        
        .container {
            display: flex;
            height: calc(100vh - 80px);
        }
        
        #map {
            flex: 1;
            min-height: 400px;
        }
        
        .sidebar {
            width: 380px;
            background: white;
            overflow-y: auto;
            border-left: 1px solid #e0e0e0;
        }
        
        .filters {
            padding: 1rem;
            background: #f8f9fa;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .filters h3 {
            font-size: 0.85rem;
            color: #666;
            margin-bottom: 0.5rem;
        }
        
        .filter-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }
        
        .filter-tag {
            padding: 0.35rem 0.75rem;
            background: white;
            border: 1px solid #ddd;
            border-radius: 20px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .filter-tag:hover { border-color: #667eea; }
        .filter-tag.active { 
            background: #667eea; 
            color: white; 
            border-color: #667eea; 
        }
        
        .playground-list {
            padding: 0.5rem;
        }
        
        .playground-card {
            background: white;
            border-radius: 12px;
            padding: 1rem;
            margin-bottom: 0.75rem;
            border: 1px solid #e8e8e8;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .playground-card:hover {
            border-color: #667eea;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.15);
            transform: translateY(-2px);
        }
        
        .playground-card.active {
            border-color: #667eea;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.25);
        }
        
        .playground-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 0.5rem;
        }
        
        .playground-name {
            font-weight: 600;
            font-size: 1rem;
            color: #333;
        }
        
        .playground-region {
            font-size: 0.7rem;
            padding: 0.2rem 0.5rem;
            background: #f0f0f0;
            border-radius: 10px;
            color: #666;
        }
        
        .playground-desc {
            font-size: 0.85rem;
            color: #666;
            line-height: 1.4;
            margin-bottom: 0.75rem;
        }
        
        .playground-features {
            display: flex;
            flex-wrap: wrap;
            gap: 0.35rem;
            margin-bottom: 0.5rem;
        }
        
        .feature-badge {
            font-size: 0.7rem;
            padding: 0.2rem 0.5rem;
            background: #e8f4fd;
            color: #1976d2;
            border-radius: 8px;
        }
        
        .playground-meta {
            display: flex;
            justify-content: space-between;
            font-size: 0.75rem;
            color: #888;
        }
        
        .age-range { color: #4caf50; font-weight: 500; }
        
        .popup-content h3 {
            color: #667eea;
            margin-bottom: 0.5rem;
        }
        
        .popup-content p {
            font-size: 0.85rem;
            margin-bottom: 0.5rem;
        }
        
        .popup-features {
            display: flex;
            flex-wrap: wrap;
            gap: 0.25rem;
        }
        
        .popup-features span {
            font-size: 0.7rem;
            background: #e8f4fd;
            padding: 0.15rem 0.4rem;
            border-radius: 4px;
        }
        
        @media (max-width: 768px) {
            .container { flex-direction: column; }
            .sidebar { width: 100%; height: 50vh; }
            #map { height: 50vh; }
        }
        
        .stats-bar {
            display: flex;
            justify-content: center;
            gap: 2rem;
            padding: 0.5rem;
            background: rgba(255,255,255,0.1);
            margin-top: 0.5rem;
            border-radius: 8px;
        }
        
        .stat { text-align: center; }
        .stat-value { font-size: 1.25rem; font-weight: 700; }
        .stat-label { font-size: 0.7rem; opacity: 0.8; }
    </style>
</head>
<body>
    <header>
        <h1>üé† SG Playground Finder</h1>
        <p>Find the perfect playground for your little ones</p>
        <div class="stats-bar">
            <div class="stat">
                <div class="stat-value" id="totalCount">-</div>
                <div class="stat-label">Playgrounds</div>
            </div>
            <div class="stat">
                <div class="stat-value" id="freeCount">-</div>
                <div class="stat-label">Free Entry</div>
            </div>
            <div class="stat">
                <div class="stat-value" id="waterCount">-</div>
                <div class="stat-label">Water Play</div>
            </div>
        </div>
    </header>
    
    <div class="container">
        <div id="map"></div>
        <div class="sidebar">
            <div class="filters">
                <h3>üè∑Ô∏è Filter by Feature</h3>
                <div class="filter-tags" id="filterTags"></div>
            </div>
            <div class="playground-list" id="playgroundList"></div>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // Initialize map centered on Singapore
        const map = L.map('map').setView([1.3521, 103.8198], 12);
        
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '¬© OpenStreetMap contributors'
        }).addTo(map);
        
        // Custom marker icon
        const playgroundIcon = L.divIcon({
            html: 'üé†',
            className: 'playground-marker',
            iconSize: [30, 30],
            iconAnchor: [15, 15]
        });
        
        let playgrounds = [];
        let markers = {};
        let activeFilters = new Set();
        
        // Load playground data
        fetch('data/playgrounds.json')
            .then(r => r.json())
            .then(data => {
                playgrounds = data.playgrounds;
                
                // Update stats
                document.getElementById('totalCount').textContent = playgrounds.length;
                document.getElementById('freeCount').textContent = playgrounds.filter(p => p.isFree).length;
                document.getElementById('waterCount').textContent = playgrounds.filter(p => p.features.includes('water-play')).length;
                
                // Create filter tags
                const allFeatures = [...new Set(playgrounds.flatMap(p => p.features))];
                const filterContainer = document.getElementById('filterTags');
                
                allFeatures.forEach(feature => {
                    const tag = document.createElement('button');
                    tag.className = 'filter-tag';
                    tag.textContent = formatFeature(feature);
                    tag.onclick = () => toggleFilter(feature, tag);
                    filterContainer.appendChild(tag);
                });
                
                // Render all playgrounds
                renderPlaygrounds(playgrounds);
            });
        
        function formatFeature(feature) {
            const icons = {
                'slides': 'üõù Slides',
                'water-play': 'üí¶ Water',
                'sand-play': 'üèñÔ∏è Sand',
                'climbing': 'üßó Climbing',
                'high-element': 'üèîÔ∏è High',
                'flying-fox': 'ü¶ä Zipline',
                'swings': 'üé¢ Swings',
                'treehouse': 'üè° Treehouse',
                'nature-play': 'üåø Nature',
                'themed': 'üé® Themed',
                'educational': 'üìö Educational',
                'inclusive': '‚ôø Inclusive',
                'cargo-nets': 'üï∏Ô∏è Nets',
                'mall': 'üõí Mall',
                'rooftop': 'üåÜ Rooftop'
            };
            return icons[feature] || feature;
        }
        
        function toggleFilter(feature, tag) {
            if (activeFilters.has(feature)) {
                activeFilters.delete(feature);
                tag.classList.remove('active');
            } else {
                activeFilters.add(feature);
                tag.classList.add('active');
            }
            
            const filtered = activeFilters.size === 0 
                ? playgrounds 
                : playgrounds.filter(p => 
                    [...activeFilters].every(f => p.features.includes(f))
                  );
            
            renderPlaygrounds(filtered);
        }
        
        function renderPlaygrounds(list) {
            const container = document.getElementById('playgroundList');
            container.innerHTML = '';
            
            // Clear old markers
            Object.values(markers).forEach(m => map.removeLayer(m));
            markers = {};
            
            list.forEach(pg => {
                // Add marker
                const marker = L.marker([pg.lat, pg.lng], { icon: playgroundIcon })
                    .addTo(map)
                    .bindPopup(`
                        <div class="popup-content">
                            <h3>${pg.name}</h3>
                            <p>${pg.description.substring(0, 100)}...</p>
                            <p><strong>üïê</strong> ${pg.hours}</p>
                            <p><strong>üë∂</strong> Ages ${pg.ageRange}</p>
                            <div class="popup-features">
                                ${pg.features.slice(0, 5).map(f => `<span>${formatFeature(f)}</span>`).join('')}
                            </div>
                        </div>
                    `);
                
                markers[pg.id] = marker;
                
                // Add card
                const card = document.createElement('div');
                card.className = 'playground-card';
                card.innerHTML = `
                    <div class="playground-header">
                        <div class="playground-name">${pg.name}</div>
                        <span class="playground-region">${pg.region}</span>
                    </div>
                    <div class="playground-desc">${pg.description.substring(0, 120)}...</div>
                    <div class="playground-features">
                        ${pg.features.slice(0, 4).map(f => `<span class="feature-badge">${formatFeature(f)}</span>`).join('')}
                    </div>
                    <div class="playground-meta">
                        <span class="age-range">üë∂ ${pg.ageRange} years</span>
                        <span>üïê ${pg.hours}</span>
                    </div>
                `;
                
                card.onclick = () => {
                    document.querySelectorAll('.playground-card').forEach(c => c.classList.remove('active'));
                    card.classList.add('active');
                    map.setView([pg.lat, pg.lng], 15);
                    markers[pg.id].openPopup();
                };
                
                container.appendChild(card);
            });
        }
    </script>
</body>
</html>
