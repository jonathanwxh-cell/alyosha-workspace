<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Market Sonification Visualizer</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', system-ui, sans-serif;
            color: #e0e0e0;
            padding: 20px;
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
        }
        h1 {
            text-align: center;
            font-size: 2rem;
            margin-bottom: 10px;
            background: linear-gradient(90deg, #00d4ff, #7c3aed);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .subtitle {
            text-align: center;
            color: #888;
            margin-bottom: 30px;
        }
        .viz-container {
            background: rgba(255,255,255,0.05);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20px;
        }
        canvas {
            width: 100%;
            height: 300px;
            background: rgba(0,0,0,0.3);
            border-radius: 8px;
        }
        .legend {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
        }
        .legend-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }
        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
        }
        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            color: white;
            font-size: 1rem;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }
        button:active {
            transform: translateY(0);
        }
        .info-box {
            background: rgba(0,212,255,0.1);
            border-left: 3px solid #00d4ff;
            padding: 15px;
            border-radius: 0 8px 8px 0;
            margin-top: 20px;
        }
        .info-box h3 {
            color: #00d4ff;
            margin-bottom: 10px;
        }
        .note-indicator {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.8);
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 1.2rem;
            opacity: 0;
            transition: opacity 0.3s;
        }
        .note-indicator.active {
            opacity: 1;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéµ Market Sonification</h1>
        <p class="subtitle">Stock prices become musical notes</p>
        
        <div class="viz-container">
            <canvas id="waveform"></canvas>
            <div class="legend">
                <div class="legend-item">
                    <div class="legend-dot" style="background: #00d4ff;"></div>
                    <span>NVDA (Piano)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-dot" style="background: #ff6b6b;"></div>
                    <span>AMD (Strings)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-dot" style="background: #ffd93d;"></div>
                    <span>TSM (Bells)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-dot" style="background: #6bcb77;"></div>
                    <span>SMCI (Brass)</span>
                </div>
            </div>
            <div class="controls">
                <button onclick="playDemo()">‚ñ∂Ô∏è Play Demo</button>
                <button onclick="stopDemo()">‚èπÔ∏è Stop</button>
            </div>
        </div>
        
        <div class="info-box">
            <h3>How It Works</h3>
            <p>‚Ä¢ <strong>Price ‚Üí Pitch:</strong> Higher stock prices = higher musical notes (pentatonic scale)</p>
            <p>‚Ä¢ <strong>Volume ‚Üí Loudness:</strong> High trading volume days play louder</p>
            <p>‚Ä¢ <strong>Movement ‚Üí Melody:</strong> Price changes create the melodic contour</p>
            <p>‚Ä¢ <strong>Correlation ‚Üí Harmony:</strong> Correlated stocks sound consonant together</p>
        </div>
    </div>
    
    <div class="note-indicator" id="noteDisplay">‚ô™ C4</div>
    
    <script>
        const canvas = document.getElementById('waveform');
        const ctx = canvas.getContext('2d');
        
        // Set canvas resolution
        canvas.width = canvas.offsetWidth * 2;
        canvas.height = canvas.offsetHeight * 2;
        ctx.scale(2, 2);
        
        const width = canvas.offsetWidth;
        const height = canvas.offsetHeight;
        
        // Audio context
        let audioCtx = null;
        let isPlaying = false;
        let animationId = null;
        
        // Simulated stock data (20 days)
        const stockData = {
            NVDA: [188, 190, 187, 192, 189, 191, 188, 186, 189, 193, 195, 192, 190, 188, 191, 194, 192, 189, 190, 189],
            AMD: [155, 158, 156, 160, 157, 159, 161, 158, 156, 159, 162, 165, 163, 160, 158, 161, 164, 162, 160, 163],
            TSM: [205, 208, 206, 210, 207, 211, 209, 206, 208, 212, 215, 213, 210, 208, 211, 214, 212, 210, 211, 213],
            SMCI: [35, 37, 36, 38, 35, 37, 39, 36, 34, 38, 40, 42, 39, 37, 39, 41, 38, 36, 37, 38]
        };
        
        const colors = {
            NVDA: '#00d4ff',
            AMD: '#ff6b6b',
            TSM: '#ffd93d',
            SMCI: '#6bcb77'
        };
        
        const noteNames = ['C', 'D', 'E', 'G', 'A'];
        
        function priceToNote(price, min, max) {
            const normalized = (price - min) / (max - min);
            const noteIdx = Math.floor(normalized * 4);
            return Math.max(0, Math.min(4, noteIdx));
        }
        
        function drawWaveform(time = 0) {
            ctx.fillStyle = 'rgba(0,0,0,0.3)';
            ctx.fillRect(0, 0, width, height);
            
            const symbols = Object.keys(stockData);
            const barWidth = width / 20;
            
            symbols.forEach((symbol, si) => {
                const data = stockData[symbol];
                const min = Math.min(...data);
                const max = Math.max(...data);
                const color = colors[symbol];
                
                ctx.beginPath();
                ctx.strokeStyle = color;
                ctx.lineWidth = 2;
                
                data.forEach((price, i) => {
                    const x = i * barWidth + barWidth / 2;
                    const normalized = (price - min) / (max - min);
                    const y = height - (normalized * (height - 40) + 20);
                    
                    // Animated pulse
                    const pulse = Math.sin(time / 500 + i * 0.3 + si) * 5;
                    
                    if (i === 0) {
                        ctx.moveTo(x, y + pulse);
                    } else {
                        ctx.lineTo(x, y + pulse);
                    }
                });
                
                ctx.stroke();
                
                // Draw dots
                data.forEach((price, i) => {
                    const x = i * barWidth + barWidth / 2;
                    const normalized = (price - min) / (max - min);
                    const y = height - (normalized * (height - 40) + 20);
                    const pulse = Math.sin(time / 500 + i * 0.3 + si) * 5;
                    
                    ctx.beginPath();
                    ctx.fillStyle = color;
                    ctx.arc(x, y + pulse, 4, 0, Math.PI * 2);
                    ctx.fill();
                });
            });
            
            if (isPlaying) {
                animationId = requestAnimationFrame(() => drawWaveform(time + 16));
            }
        }
        
        function playDemo() {
            if (isPlaying) return;
            
            audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            isPlaying = true;
            
            const noteDisplay = document.getElementById('noteDisplay');
            noteDisplay.classList.add('active');
            
            const symbols = Object.keys(stockData);
            let noteIndex = 0;
            
            function playNote() {
                if (!isPlaying || noteIndex >= 20) {
                    isPlaying = false;
                    noteDisplay.classList.remove('active');
                    return;
                }
                
                symbols.forEach(symbol => {
                    const data = stockData[symbol];
                    const min = Math.min(...data);
                    const max = Math.max(...data);
                    const price = data[noteIndex];
                    const noteIdx = priceToNote(price, min, max);
                    
                    // Pentatonic frequencies
                    const freqs = [261.63, 293.66, 329.63, 392.00, 440.00];
                    const freq = freqs[noteIdx];
                    
                    // Create oscillator
                    const osc = audioCtx.createOscillator();
                    const gain = audioCtx.createGain();
                    
                    osc.type = symbol === 'NVDA' ? 'sine' : 
                               symbol === 'AMD' ? 'triangle' :
                               symbol === 'TSM' ? 'square' : 'sawtooth';
                    osc.frequency.value = freq;
                    
                    gain.gain.setValueAtTime(0.15, audioCtx.currentTime);
                    gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.3);
                    
                    osc.connect(gain);
                    gain.connect(audioCtx.destination);
                    
                    osc.start();
                    osc.stop(audioCtx.currentTime + 0.35);
                });
                
                noteDisplay.textContent = `‚ô™ Day ${noteIndex + 1}`;
                noteIndex++;
                
                setTimeout(playNote, 400);
            }
            
            drawWaveform();
            playNote();
        }
        
        function stopDemo() {
            isPlaying = false;
            if (animationId) {
                cancelAnimationFrame(animationId);
            }
            document.getElementById('noteDisplay').classList.remove('active');
            drawWaveform(0);
        }
        
        // Initial draw
        drawWaveform(0);
    </script>
</body>
</html>
